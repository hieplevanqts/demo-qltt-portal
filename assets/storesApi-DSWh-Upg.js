import{e as c,h as u}from"./plans-CUEgwpG0.js";function m(e){if(!e)return"none";switch(e){case 1:return"high";case 2:return"medium";case 3:return"low";default:return"none"}}function b(e){return e&&["active","pending","suspended","rejected","closed"].includes(e)?e:"pending"}async function x(e=1e4,t=0,s){try{let r=`${c}/merchants?limit=${e}&offset=${t}&order=created_at.desc&select=*`;if(s!=null&&s.status&&(r+=`&status=eq.${encodeURIComponent(s.status)}`),s!=null&&s.province_id&&(r+=`&province_id=eq.${encodeURIComponent(s.province_id)}`),s!=null&&s.district&&(r+=`&district=eq.${encodeURIComponent(s.district)}`),s!=null&&s.businessType&&(r+=`&business_type=eq.${encodeURIComponent(s.businessType)}`),s!=null&&s.riskLevel&&s.riskLevel!=="all"){const n=s.riskLevel==="high"?1:s.riskLevel==="medium"?2:3;r+=`&risk_level=eq.${n}`}const i=await fetch(r,{method:"GET",headers:u()});if(!i.ok){const n=await i.text();throw console.error("âŒ Fetch stores failed:",i.status,i.statusText),console.error("Error details:",n),new Error(`Failed to fetch stores: ${i.status} ${i.statusText}`)}const o=await i.json();console.log("âœ… Fetched merchants data:",o.length,"records"),s!=null&&s.province_id&&console.log("ğŸ“ Filtered by province_id:",s.province_id);const _=o.map((n,a)=>{var w,h;const g=parseInt(n.id.split("-")[0],16)%1e8||a,l=parseFloat(n.latitude)||void 0,d=parseFloat(n.longitude)||void 0,y=l&&d?`${l.toFixed(6)}, ${d.toFixed(6)}`:void 0,p={id:g,merchantId:n._id,name:n.business_name||"Unnamed Store",address:n.address||"",type:n.business_type||"ChÆ°a xÃ¡c Ä‘á»‹nh",status:b(n.status),riskLevel:m(n.risk_level),province:n.province||"TP. Há»“ ChÃ­ Minh",provinceCode:n.province_id||"",jurisdiction:n.district||"Quáº­n 1",jurisdictionCode:n.province_id||"",ward:n.ward||"",wardCode:n.ward_id||"",managementUnit:`Chi cá»¥c QLTT ${n.district||"Quáº­n 1"}`,latitude:l,longitude:d,gpsCoordinates:y,taxCode:n.tax_code||"",businessType:n.business_type||"",ownerName:n.owner_name||"",ownerPhone:n.owner_phone||"",ownerPhone2:n.owner_phone_2||"",ownerBirthYear:n.owner_birth_year,ownerIdNumber:n.owner_identity_no||"",ownerEmail:n.owner_email||"",businessPhone:n.business_phone||"",email:n.business_email||"",website:n.website||"",fax:n.fax||"",businessArea:((w=n.store_area)==null?void 0:w.toString())||"",area_name:((h=n.store_area)==null?void 0:h.toString())||"",notes:n.note||"",lastInspection:n.last_inspection?new Date(n.last_inspection).toLocaleDateString("vi-VN"):"ChÆ°a kiá»ƒm tra",isVerified:n.verified||!1,phone:n.owner_phone||"",district:n.district||"",establishedDate:n.established_date||"",operationStatus:"Äang hoáº¡t Ä‘á»™ng",sourceType:"import"};return a===0&&console.log("âœ… First store mapped:",{business_name:n.business_name,owner_name:n.owner_name,owner_phone:n.owner_phone,status:n.status,mapped_to:{name:p.name,ownerName:p.ownerName,ownerPhone:p.ownerPhone,status:p.status}}),p});return console.log("âœ… Successfully mapped",_.length,"stores"),_}catch(r){throw console.error("âŒ Error fetching stores:",r),r}}async function f(e){var t;try{const s=`${c}/merchants?_id=eq.${e}&select=*&limit=1`,r=await fetch(s,{method:"GET",headers:u()});if(!r.ok)throw new Error(`Failed to fetch store: ${r.status}`);const i=await r.json();if(!i||i.length===0)return null;const o=i[0],_=parseInt(o.id.split("-")[0],16)%1e8||0,n=parseFloat(o.latitude)||void 0,a=parseFloat(o.longitude)||void 0;return console.log("âœ… [fetchStoreById] API returned merchant:",{url_query_id:e,merchant_id_uuid:o._id,business_name:o.business_name,numeric_id:_,timestamp:new Date().toISOString()}),{id:_,merchantId:o._id,name:o.business_name||"",address:o.address||"",type:o.business_type||"",status:b(o.status),riskLevel:m(o.risk_level),area_name:((t=o.store_area)==null?void 0:t.toString())||"",province:o.province||"",provinceCode:o.province_id||"",jurisdiction:o.district||"",jurisdictionCode:o.province_id||"",ward:o.ward||"",wardCode:o.ward_id||"",managementUnit:`Chi cá»¥c QLTT ${o.district||"Quáº­n 1"}`,latitude:n,longitude:a,gpsCoordinates:n&&a?`${n.toFixed(6)}, ${a.toFixed(6)}`:void 0,taxCode:o.tax_code||"",businessType:o.business_type||"",ownerName:o.owner_name||"",ownerPhone:o.owner_phone||"",businessPhone:o.business_phone||"",email:o.business_email||"",website:o.website||"",fax:o.fax||"",lastInspection:o.last_inspection?new Date(o.last_inspection).toLocaleDateString("vi-VN"):"ChÆ°a kiá»ƒm tra",isVerified:o.verified||!1,phone:o.owner_phone||"",district:o.district||""}}catch(s){return console.error("âŒ Error fetching store by ID:",s),null}}async function S(e){try{const t=`${c}/rpc/create_merchant_full`;console.log("ğŸ“¤ Creating merchant with data:",e);const s={p_business_name:e.p_business_name,p_owner_name:e.p_owner_name,p_owner_phone:e.p_owner_phone,p_license_status:e.p_license_status||"valid",p_tax_code:e.p_tax_code,p_business_type:e.p_business_type,p_province_id:e.p_province_id,p_ward_id:e.p_ward_id,p_address:e.p_address,p_latitude:e.p_latitude,p_longitude:e.p_longitude,p_status:e.p_status||"pending",p_established_date:e.p_established_date||null,p_fax:e.p_fax||null,p_department_id:e.p_department_id,p_note:e.p_note||null,p_business_phone:e.p_business_phone||null,p_business_email:e.p_business_email||null,p_website:e.p_website||null,p_store_area:e.p_store_area||null,p_owner_phone_2:e.p_owner_phone_2||null,p_owner_birth_year:e.p_owner_birth_year||null,p_owner_identity_no:e.p_owner_identity_no||null,p_owner_email:e.p_owner_email||null};console.log("ğŸ“¤ Complete payload with all parameters:",s);const r=await fetch(t,{method:"POST",headers:u(),body:JSON.stringify(s)});if(!r.ok){const o=await r.text();throw console.error("âŒ Create merchant failed:",r.status,r.statusText),console.error("Error details:",o),new Error(`Failed to create merchant: ${r.status} ${r.statusText}
${o}`)}const i=await r.json();return console.log("âœ… Merchant created successfully:",i),i}catch(t){throw console.error("âŒ Error creating merchant:",t),t}}async function $(e,t){try{const s=`${c}/rpc/update_merchant_full`;console.log("ï¿½ [updateMerchant] Calling API:",{merchant_id:e,endpoint:"/rpc/update_merchant_full",fields_updating:Object.keys(t).filter(_=>t[_]!==void 0).length,timestamp:new Date().toISOString()});const r={p_merchant_id:e,p_business_name:t.p_business_name||null,p_owner_name:t.p_owner_name||null,p_owner_phone:t.p_owner_phone||null,p_license_status:t.p_license_status||"valid",p_tax_code:t.p_tax_code||null,p_business_type:t.p_business_type||null,p_province_id:t.p_province_id||null,p_ward_id:t.p_ward_id||null,p_address:t.p_address||null,p_latitude:t.p_latitude||null,p_longitude:t.p_longitude||null,p_status:t.p_status||"active",p_established_date:t.p_established_date||null,p_fax:t.p_fax||null,p_department_id:t.p_department_id||null,p_note:t.p_note||null,p_business_phone:t.p_business_phone||null,p_business_email:t.p_business_email||null,p_website:t.p_website||null,p_store_area:t.p_store_area||null,p_owner_phone_2:t.p_owner_phone_2||null,p_owner_birth_year:t.p_owner_birth_year||null,p_owner_identity_no:t.p_owner_identity_no||null,p_owner_email:t.p_owner_email||null};console.log("ğŸ“¤ [updateMerchant] Request payload:",{p_merchant_id:r.p_merchant_id,p_business_name:r.p_business_name,p_owner_name:r.p_owner_name,p_province_id:r.p_province_id,p_ward_id:r.p_ward_id,timestamp:new Date().toISOString()});const i=await fetch(s,{method:"POST",headers:u(),body:JSON.stringify(r)});if(!i.ok){const _=await i.text();throw console.error("âŒ [updateMerchant] API error:",{merchant_id:e,status:i.status,statusText:i.statusText,error:_,timestamp:new Date().toISOString()}),new Error(`Failed to update merchant: ${i.status} ${i.statusText}
${_}`)}const o=await i.json();return console.log("âœ… [updateMerchant] Success response:",{merchant_id:e,result:o,timestamp:new Date().toISOString()}),o}catch(s){throw console.error("âŒ [updateMerchant] Error:",{merchant_id:e,error_message:s.message,timestamp:new Date().toISOString()}),s}}async function T(e){try{const t=`${c}/merchant_licenses?merchant_id=eq.${e}&order=license_type.asc,created_at.desc,_id.desc&limit=100`;console.log("ğŸ“„ [fetchMerchantLicenses] Fetching licenses for merchant:",e);const s=await fetch(t,{method:"GET",headers:u()});if(!s.ok){const i=await s.text();throw console.error("âŒ [fetchMerchantLicenses] API error:",{merchant_id:e,status:s.status,statusText:s.statusText,error:i}),new Error(`Failed to fetch merchant licenses: ${s.status} ${s.statusText}`)}const r=await s.json();return console.log("âœ… [fetchMerchantLicenses] Fetched licenses:",{merchant_id:e,count:r.length,types:r.map(i=>i.license_type)}),r}catch(t){return console.error("âŒ [fetchMerchantLicenses] Error:",{merchant_id:e,error_message:t.message}),[]}}export{T as a,x as b,S as c,f,$ as u};
